(()=>{var e;function t(){var e={title:"Chat",customIcon:null,botIcon:{svgWidth:"24px",svgHeight:"24px",width:"24px",height:"24px",objectFit:"contain",botAvatarUrl:null},theme:{primary:"#0078d4",userBubble:"#e6f0fa",botBubble:"#f1f1f1",userText:"#22223b",botText:"#4a4e69",background:"#fff",containerBg:"#ffffff",messagesBg:"#ffffff",inputContainerBg:"#ffffff",border:"#ccc",text:"#222",width:"100%",maxWidth:"350px",minWidth:"220px",borderRadius:"8px",fontFamily:"sans-serif",zIndex:9999,inputBg:"#fff",inputText:"#222",sendBtnBg:"#0078d4",sendBtnText:"#fff",sendBtnSvgColor:"#fff",sendBtnHover:"#005fa3",shadow:"0 2px 8px rgba(0,0,0,0.15)",salesRepBubble:"#f1f5f9",salesRepText:"#475569",salesRepAvatar:"#E4E7FC",userAvatar:"#8349ff",botAvatar:"#E4E7FC",userAvatarSvgColor:"#fff",botAvatarSvgColor:"#8349ff",salesRepAvatarSvgColor:"#8349ff",userAvatarBorder:"none",botAvatarBorder:"none",salesRepAvatarBorder:"none",timestampColor:"#9ca3af",messageFontFamily:"inherit",handoverNotificationBg:"#E4E7FC",handoverNotificationText:"#334155",handoverNotificationBorder:"#8349FF",closeBtnIconStyle:{display:""},headerStyle:{backgroundColor:"rgba(34, 34, 59, 0.95)",textColor:"#fff",fontWeight:"600",fontFamily:"",height:"auto",padding:"32px",borderRadius:"12px",logoStyle:{logoUrl:"",logoWidth:"24px",logoHeight:"24px",borderRadius:"0"}}}},C=window.SimpleChatEmbedConfig?{...e,...window.SimpleChatEmbedConfig,theme:{...e.theme,...window.SimpleChatEmbedConfig.theme||{}}}:e,k=C.theme,n=C.welcomeMessage||null,E=C.welcomeMessageStyle||{},O=C.socketUrl+"/ws/app/",v=void 0===C.leadCapture||C.leadCapture,W=C.ngrok??!1,z=C.isMobileDevice??!1,l=null,o=null,s=!1,m=null,T=!1,w=!1,r=null,j=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);function A(){w?(y.style.opacity="0.5",y.style.cursor="not-allowed",c.style.opacity="0.5",c.style.cursor="not-allowed"):(y.style.opacity="1",y.style.cursor="pointer",c.style.opacity="1",c.style.cursor="pointer")}function D(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}var t=document.createElement("div");function J(){window.innerWidth<768?(t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.width="100%",t.style.height="100dvh",t.style.borderRadius="0",t.style.maxHeight="100dvh"):(t.style.position="fixed",t.style.top="auto","left"===C.position?(t.style.left="20px",t.style.right="auto"):(t.style.left="auto",t.style.right="20px"),t.style.bottom="20px",t.style.width="384px",t.style.height="80vh",t.style.borderRadius=k.headerStyle&&k.headerStyle.borderRadius||"12px",t.style.maxHeight="650px")}t.id="simple-chat-embed",t.style.position="fixed",t.style.bottom="20px","left"===C.position?(t.style.left="20px",t.style.right="auto"):(t.style.right="20px",t.style.left="auto"),console.log(k.containerBorderStyle,"my border style"),t.style.width="384px",t.style.height="80vh",t.style.maxHeight="650px",t.style.background=k.containerBg||"#ffffff",t.style.border=k.containerBorderStyle||"1px solid #e2e8f0",t.style.borderRadius=k.headerStyle&&k.headerStyle.borderRadius||"12px",t.style.boxShadow="0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",t.style.fontFamily=k.fontFamily+", Inter, system-ui, sans-serif",t.style.zIndex=k.zIndex,t.style.color=k.text,t.style.transition="transform 0.3s ease-in-out",t.style.display="flex",t.style.flexDirection="column",t.style.overflow="hidden",J(),window.addEventListener("resize",J);var $=window.innerHeight;function P(){var e;j&&window.innerWidth<768&&(e=window.innerHeight,100<$-e?(t.style.height=e+"px",t.style.maxHeight=e+"px",setTimeout(function(){f.scrollIntoView({behavior:"smooth",block:"end"})},100)):(t.style.height="100vh",t.style.height="100dvh",t.style.maxHeight="100vh",t.style.maxHeight="100dvh"))}window.addEventListener("resize",P),window.visualViewport&&window.visualViewport.addEventListener("resize",P);var e=document.createElement("div"),i=(e.style.display="flex",e.style.justifyContent="space-between",e.style.alignItems="center",e.style.background=k.headerStyle&&k.headerStyle.backgroundColor||k.headerBg||"#16a34a",e.style.color=k.headerStyle&&k.headerStyle.textColor||k.headerText||"#fff",e.style.padding=k.headerStyle&&k.headerStyle.padding||"32px",e.style.height=k.headerStyle&&k.headerStyle.height||"auto",e.style.borderTopLeftRadius=k.headerStyle&&k.headerStyle.borderRadius||"12px",e.style.borderTopRightRadius=k.headerStyle&&k.headerStyle.borderRadius||"12px",e.style.fontWeight=k.headerStyle&&k.headerStyle.fontWeight||"600",e.style.fontFamily=k.headerStyle&&k.headerStyle.fontFamily||k.messageFontFamily||k.fontFamily||"sans-serif",e.style.fontSize=k.headerStyle&&k.headerStyle.fontSize||"18px",e.style.lineHeight="28px",e.style.position="sticky",e.style.top="0",document.createElement("div")),a=(i.style.display="flex",i.style.alignItems="center",i.style.gap="12px",k.headerStyle&&k.headerStyle.logoStyle||k.headerStyle||{}),d=a.logoUrl||k.headerStyle&&k.headerStyle.logoUrl||"",d=(d&&((u=document.createElement("img")).src=d,u.alt="Logo",u.style.width=a.logoWidth||k.headerStyle&&k.headerStyle.logoWidth||"24px",u.style.height=a.logoHeight||k.headerStyle&&k.headerStyle.logoHeight||"24px",u.style.borderRadius=a.borderRadius||"0",u.style.objectFit="cover",i.appendChild(u)),document.createElement("div")),a=(d.innerText=C.title,i.appendChild(d),e.appendChild(i),document.createElement("div")),y=(a.style.display="flex",a.style.gap="4px",document.createElement("button")),c=(y.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="m21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>',y.title="Clear chat history",y.style.background="transparent",y.style.color=k.headerStyle&&k.headerStyle.textColor||k.headerText||"#fff",y.style.border="none",y.style.padding="8px",y.style.cursor="pointer",y.style.borderRadius="6px",y.style.display="flex",y.style.alignItems="center",y.style.justifyContent="center",y.style.transition="background-color 0.2s ease-in-out",y.onmouseover=function(){w||(y.style.backgroundColor="rgba(255,255,255,0.1)")},y.onmouseout=function(){y.style.backgroundColor="transparent"},y.onclick=function(){if(!w){var e=JSON.parse(localStorage.getItem("simple-chat-messages")||"[]").some(function(e){return e.isSystemNotification&&"joined"===e.notificationType}),t=localStorage.getItem("simple-chat-session"),o=!1;if(t)try{o=!0===JSON.parse(t).handoverOccurred}catch(e){console.log("Error reading session handover flag:",e)}localStorage.removeItem("simple-chat-messages"),T=!(!e&&!o),F(),n&&H(n,"bot","welcomeMessage"),S()}},document.createElement("button")),p=(c.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><path d="M10 11v6"/><path d="M14 11v6"/></svg>',c.title="Clear session & restart",c.style.background="transparent",c.style.color=k.headerStyle&&k.headerStyle.textColor||k.headerText||"#fff",c.style.border="none",c.style.padding="8px",c.style.cursor="pointer",c.style.borderRadius="6px",c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="center",c.style.transition="background-color 0.2s ease-in-out",c.onmouseover=function(){w||(c.style.backgroundColor="rgba(255,255,255,0.1)")},c.onmouseout=function(){c.style.backgroundColor="transparent"},c.onclick=function(){w||(localStorage.removeItem("simple-chat-messages"),localStorage.removeItem("simple-chat-session"),localStorage.removeItem("simple-chat-leads"),localStorage.removeItem("simple-chat-user-guid"),w=T=!1,window.__simpleChatEmbedLeadCaptured=!1,m=null,l&&(l.close(),l=null,s=!1),L.innerHTML="",v?(f.style.display="none",K(function(e){w=!1,A(),window.__simpleChatEmbedLeadCaptured=!0,e&&(window.SimpleChatEmbedLead=e),F(),n&&H(n,"bot","welcomeMessage"),S()})):(window.__simpleChatEmbedLeadCaptured=!0,F(),oe(null,null,null,null).then(()=>{n&&H(n,"bot","welcomeMessage"),S(),M()}).catch(e=>{console.error("Failed to create anonymous visitor:",e),n&&H(n,"bot","welcomeMessage"),S(),M()})))},document.createElement("button")),u=(p.style.display=k.closeBtnIconStyle.display||"flex",p.setAttribute("id","close-btn"),p.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',p.title="Close chat",p.style.background="transparent",p.style.color=k.headerStyle&&k.headerStyle.textColor||k.headerText||"#fff",p.style.border="none",p.style.padding="8px",p.style.cursor="pointer",p.style.borderRadius="6px",p.style.alignItems="center",p.style.justifyContent="center",p.style.transition="background-color 0.2s ease-in-out",p.onmouseover=function(){p.style.backgroundColor="rgba(255,255,255,0.1)"},p.onmouseout=function(){p.style.backgroundColor="transparent"},p),L=(a.appendChild(y),a.appendChild(c),a.appendChild(p),e.appendChild(a),t.appendChild(e),document.createElement("div")),d=(L.style.flex="1 1 0%",L.style.overflowY="auto",L.style.overflowX="hidden",L.style.padding=k.messagesContainerPadding||"16px",L.style.background=k.messagesBg||"#ffffff",L.style.webkitOverflowScrolling="touch",L.id="chat-messages",L.style.display="flex",L.style.flexDirection="column",L.style.gap="16px",L.style.scrollBehavior="smooth",L.style.scrollbarWidth="none",L.style.msOverflowStyle="none",document.createElement("style")),i=(d.textContent=`
        #chat-messages::-webkit-scrollbar { display: none; }
        #simple-chat-embed ul { list-style-type: disc !important; }
        #simple-chat-embed ol { list-style-type: decimal !important; }
        #simple-chat-embed ul li::marker { color: #6b7280; }
        #simple-chat-embed ol li::marker { color: #6b7280; font-weight: 600; }
        #simple-chat-embed pre { white-space: pre-wrap; word-wrap: break-word; }
        #simple-chat-embed code { word-wrap: break-word; }
        #simple-chat-embed blockquote { 
            border-left: 4px solid #e5e7eb; 
            padding-left: 16px; 
            margin: 16px 0; 
            color: #6b7280; 
            font-style: italic; 
        }
   @media (max-width: 767px) {
            #simple-chat-embed input,
            #simple-chat-embed textarea,
            #simple-chat-embed button {
                font-size: 16px !important; /* Prevents zoom on iOS */
                -webkit-appearance: none;
                appearance: none;
            }
        }
    `,document.head.appendChild(d),t.appendChild(L),k.scrollButtonStyle||{}),a=i.iconColor||"#ffffff",q=i.backgroundColor||k.sendBtnBg||"#3b82f6",Z=i.hoverColor||k.sendBtnHover||"#2563eb",e=i.position||{},d=e.right||"16px",i=e.bottom||"80px",g=document.createElement("button"),e=(g.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7 13 5 5 5-5"/><path d="M12 18V6"/></svg>',g.title="Scroll to bottom",g.style.position="absolute",g.style.right=d,g.style.bottom=i,g.style.width="40px",g.style.height="40px",g.style.borderRadius="50%",g.style.background=q,g.style.color=a,g.style.border="none",g.style.cursor="pointer",g.style.display="none",g.style.alignItems="center",g.style.justifyContent="center",g.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",g.style.transition="all 0.3s ease",g.style.zIndex="10",g.addEventListener("mouseover",function(){g.style.backgroundColor=Z,g.style.transform="scale(1.1)"}),g.addEventListener("mouseout",function(){g.style.backgroundColor=q,g.style.transform="scale(1)"}),g.onclick=function(){L.scrollTop=L.scrollHeight,g.style.display="none"},t.appendChild(g),k.inputContainerStyle||{}),U=e.padding||"16px",V=e.borderTop||"1px solid #ececec",f=document.createElement("div"),I=(f.style.padding=U,f.style.background=k.inputContainerBg||"#ffffff",f.style.display="flex",f.style.flexDirection="column",f.style.borderBottomLeftRadius="12px",f.style.borderBottomRightRadius="12px",document.createElement("div")),h=(I.style.display="none",I.style.flexDirection="row",I.style.flexWrap="wrap",I.style.gap="8px",I.style.paddingLeft="44px",I.style.width="auto",C.quickQuestions&&0<C.quickQuestions.length&&C.quickQuestions.forEach(function(e,t){var o=document.createElement("button");o.innerText=e,o.style.padding="8px 16px",o.style.background="#ffffff",o.style.color="#6b7280",o.style.border="1px solid #e5e7eb",o.style.borderRadius="9999px",o.style.cursor="pointer",o.style.fontSize="14px",o.style.fontWeight="500",o.style.transition="all 0.2s ease-in-out",o.style.width="auto",o.style.textAlign="center",o.style.boxSizing="border-box",o.style.whiteSpace="nowrap",o.addEventListener("mouseover",function(){o.style.borderColor=k.primary||"#8349FF",o.style.color=k.primary||"#8349FF",o.style.background="#ffffff"}),o.addEventListener("mouseout",function(){o.style.background="#ffffff",o.style.color="#6b7280",o.style.borderColor="#e5e7eb"}),o.addEventListener("click",function(){x.value=e,G(),C.quickQuestionsPermanent||(I.style.display="none")}),I.appendChild(o)}),t.appendChild(f),document.createElement("div")),x=(h.style.display="grid",h.style.gridTemplateColumns="1fr auto",h.style.gap="16px",h.style.alignItems="center",h.style.width="100%",document.createElement("input")),b=(x.type="text",x.placeholder="Type your message...",x.style.padding="12px 16px",x.style.border=k.inputContainerStyle?.inputStyle?.border||"1px solid #d1d5db",x.style.borderRadius="6px",x.style.background="#ffffff",x.style.color="#374151",x.style.fontSize="14px",x.style.lineHeight="20px",x.style.outline=k.inputContainerStyle?.inputStyle?.outline||"none",x.style.transition=k.inputContainerStyle?.inputStyle?.transition||"border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out",x.style.fontFamily=k.messageFontFamily||k.fontFamily||"sans-serif",x.addEventListener("focus",function(){x.style.border=k.inputContainerStyle?.inputStyle?.borderOnFocus||"1px solid #3b82f6",x.style.boxShadow=k.inputContainerStyle?.inputStyle?.boxShadowOnFocus||"0 0 0 3px rgba(59, 130, 246, 0.1)"}),x.addEventListener("blur",function(){x.style.border=k.inputContainerStyle?.inputStyle?.borderOnBlur||"1px solid #d1d5db",x.style.boxShadow=k.inputContainerStyle?.inputStyle?.boxShadowOnBlur||"none"}),x.addEventListener("input",function(){x.value.trim()?(b.disabled=!1,b.style.opacity="1",b.style.cursor="pointer"):(b.disabled=!0,b.style.opacity="0.5",b.style.cursor="not-allowed")}),document.createElement("button")),d=(b.title="Send",k.sendBtnSvgColor||"#fff");function Q(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}function S(){var e=JSON.parse(localStorage.getItem("simple-chat-messages")||"[]");L.innerHTML="",e.some(function(e){return e.isSystemNotification&&"joined"===e.notificationType})&&(T=!0);for(var t,o=0;o<e.length;o++){var n=e[o];if(n.isSystemNotification){var l=document.createElement("div"),s=(l.style.display="flex",l.style.justifyContent="center",l.style.margin="16px 0",l.style.animation="fadeInUp 0.5s ease-out",document.createElement("div")),r=(s.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)",s.style.color="#ffffff",s.style.padding="12px 24px",s.style.borderRadius="20px",s.style.fontSize="14px",s.style.fontWeight="500",s.style.display="flex",s.style.alignItems="center",s.style.gap="8px",s.style.maxWidth="80%",s.style.textAlign="center",document.createElement("span"));"joined"===n.notificationType?(r.innerHTML="ðŸ‘‹",s.style.background=k.handoverNotificationBg||"#E4E7FC",s.style.color=k.handoverNotificationText||"#334155",s.style.border="1px solid "+(k.handoverNotificationBorder||"#8349FF")):r.innerHTML="ðŸ’¬",r.style.fontSize="16px",s.appendChild(r),s.appendChild(document.createTextNode(n.text)),l.appendChild(s),document.getElementById("system-notification-style")||((r=document.createElement("style")).id="system-notification-style",r.innerHTML=`
                        @keyframes fadeInUp {
                            0% { opacity: 0; transform: translateY(20px); }
                            100% { opacity: 1; transform: translateY(0); }
                        }
                    `,document.head.appendChild(r)),L.appendChild(l)}else{var i,a,d,y,c,p,s=document.createElement("div"),r=(s.style.display="flex",s.style.flexDirection="column",s.style.marginBottom="16px",document.createElement("div")),l=(r.style.display="flex",r.style.gap="8px","user"===n.sender&&(r.style.flexDirection="row-reverse",r.style.justifyContent="flex-start"),null),m=("user"===n.sender?((l=document.createElement("div")).style.width="40px",l.style.height="40px",l.style.borderRadius="50%",l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.background=k.userAvatar||"#8349ff",l.style.border=k.userAvatarBorder||"none",a=document.createElement("div"),i=k.userAvatarSvgColor||"#fff",a.innerHTML=`
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 21V19C19 17.9391 18.5786 16.9217 17.8284 16.1716C17.0783 15.4214 16.0609 15 15 15H9C7.93913 15 6.92172 15.4214 6.17157 16.1716C5.42143 16.9217 5 17.9391 5 19V21" stroke="${i}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="${i}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                `,l.appendChild(a)):"sales_rep"===n.sender?((l=document.createElement("div")).style.width="40px",l.style.height="40px",l.style.borderRadius="50%",l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.background=k.salesRepAvatar||"#E4E7FC",l.style.border=k.salesRepAvatarBorder||"none",p=k.salesRepAvatarSvgColor||k.primary||"#8349FF",l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" style="width:26px;height:26px;color:'+p+';" width="200" height="200" viewBox="0 0 24 24"><path fill="currentColor" d="M19.938 8H21a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-1.062A8.001 8.001 0 0 1 12 23v-2a6 6 0 0 0 6-6V9A6 6 0 0 0 6 9v7H3a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h1.062a8.001 8.001 0 0 1 15.876 0ZM3 10v4h1v-4H3Zm17 0v4h1v-4h-1ZM7.76 15.785l1.06-1.696A5.972 5.972 0 0 0 12 15a5.972 5.972 0 0 0 3.18-.911l1.06 1.696A7.963 7.963 0 0 1 12 17a7.962 7.962 0 0 1-4.24-1.215Z"/></svg>'):"bot"!==n.sender&&"ai"!==n.sender||((l=document.createElement("div")).style.width="40px",l.style.height="40px",l.style.borderRadius="50%",l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.background=k.botAvatar||"#E4E7FC",l.style.border=k.botAvatarBorder||"none",l.style.overflow="hidden",i=document.createElement("div"),m=(a=k.botIcon||C.botIcon||{}).width||"24px",u=a.height||"24px",d=a.svgWidth||a.width||"24px",g=a.svgHeight||a.height||"24px",y=a.objectFit||"contain",c=a.botAvatarUrl,i.style.width=m,i.style.height=u,i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",c?i.innerHTML=`<img src="${c}" alt="Bot" style="width: ${d}; height: ${g}; object-fit: ${y};" />`:(p=k.botAvatarSvgColor||k.primary||"#8349ff",i.innerHTML=`
                        <svg width="${d}" height="${g}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g clip-path="url(#clip0_4_4929)">
                                <path d="M19 11H5C3.89543 11 3 11.8954 3 13V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V13C21 11.8954 20.1046 11 19 11Z" stroke="${p}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 7C13.1046 7 14 6.10457 14 5C14 3.89543 13.1046 3 12 3C10.8954 3 10 3.89543 10 5C10 6.10457 10.8954 7 12 7Z" stroke="${p}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 7V11" stroke="${p}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </g>
                            <defs>
                                <clipPath id="clip0_4_4929">
                                    <rect width="24" height="24" fill="white"/>
                                </clipPath>
                            </defs>
                        </svg>
                    `),l.appendChild(i)),document.createElement("div")),u=(m.style.display="flex",m.style.flexDirection="column",m.style.gap="8px",m.style.maxWidth=(n.sender,"70%"),document.createElement("div"));if(u.style.padding="12px 16px",u.style.wordBreak="break-word",u.style.fontSize="14px",u.style.lineHeight="20px",u.style.fontFamily=k.messageFontFamily||k.fontFamily||"sans-serif",u.style.position="relative","user"===n.sender?(u.style.background=k.userBubble||"#dbeafe",u.style.color=k.userText||"#1e40af",u.style.alignSelf="flex-end",u.style.borderRadius="16px 16px 4px 16px",u.style.boxShadow="0 2px 8px rgba(59, 130, 246, 0.15)"):"sales_rep"===n.sender?(u.style.background=k.salesRepBubble||"#f1f5f9",u.style.color=k.salesRepText||"#475569",u.style.alignSelf="flex-start",u.style.borderRadius="16px 16px 16px 4px"):(u.style.background=k.botBubble||"#f1f5f9",u.style.color=k.botText||"#475569",u.style.alignSelf="flex-start",u.style.borderRadius="16px 16px 16px 4px",u.style.boxShadow="0 2px 8px rgba(71, 85, 105, 0.1)"),""===n.text&&o===e.length-1)u.appendChild((y=c=void 0,(c=document.createElement("span")).style.display="inline-flex",c.style.alignItems="center",c.style.height="1.5em",y=k.botText||"#4a4e69",c.innerHTML=`
      <span style="display:inline-block;width:8px;height:8px;margin:0 2px;background:${y};border-radius:50%;animation:bounce 1s infinite alternate;"></span>
      <span style="display:inline-block;width:8px;height:8px;margin:0 2px;background:${y};border-radius:50%;animation:bounce 1s 0.2s infinite alternate;"></span>
      <span style="display:inline-block;width:8px;height:8px;margin:0 2px;background:${y};border-radius:50%;animation:bounce 1s 0.4s infinite alternate;"></span>
    `,document.getElementById("simple-chat-bounce-style")||((y=document.createElement("style")).id="simple-chat-bounce-style",y.innerHTML="@keyframes bounce { 0% { transform: translateY(0); } 100% { transform: translateY(-7px); } }",document.head.appendChild(y)),c));else if("[Image]"===n.text&&0<o&&"string"==typeof(d=e[o-1].text)&&d.startsWith("data:image/")){var g=document.createElement("img");g.src=e[o-1].text,g.style.maxWidth="200px",g.style.maxHeight="150px",g.style.borderRadius="8px",g.style.display="block",u.appendChild(g)}else{var f=document.createElement("div");if("bot"===n.sender||"ai"===n.sender){var h=(t=>{if(!t)return"";try{if("undefined"==typeof marked)throw new Error("marked.js not available");var e=marked.parse(t,{breaks:!0,gfm:!0});return"string"==typeof e?e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<p>/g,'<p style="font-size:inherit;line-height:inherit;font-family:inherit;font-weight:inherit;margin:0;">')).replace(/<a\s+href="([^"]*)"([^>]*)>([^<]*)<\/a>/g,function(e,t,o,n){return'<a href="'+t+'" target="_blank" style="font-weight:bold;color:'+(k.botText||"#4a4e69")+';text-decoration:underline;cursor:pointer;">'+n+"</a>"})).replace(/<ul>/g,'<ul style="margin:8px 0;padding-left:24px;">')).replace(/<ol>/g,'<ol style="margin:8px 0;padding-left:24px;">')).replace(/<li>/g,'<li style="margin:4px 0;">')).replace(/<pre><code>/g,"<pre style=\"background:#f6f8fa;border:1px solid #e1e4e8;border-radius:6px;padding:16px;margin:8px 0;overflow-x:auto;font-family:ui-monospace,SFMono-Regular,'SF Mono',Consolas,'Liberation Mono',Menlo,monospace;font-size:13px;line-height:1.45;\"><code>")).replace(/<code>/g,"<code style=\"background:#f6f8fa;border-radius:3px;padding:2px 4px;font-family:ui-monospace,SFMono-Regular,'SF Mono',Consolas,'Liberation Mono',Menlo,monospace;font-size:85%;\">")).replace(/<strong>/g,'<strong style="font-weight:600;">')).replace(/<em>/g,'<em style="font-style:italic;">'):String(e)}catch(e){return console.error("Markdown parsing error:",e),Q(t).replace(/\n/g,"<br>")}})(n.text);if(n.isWelcomeMessage&&E){var x,b=document.createElement("div"),v=(b.innerHTML=h,b.querySelectorAll("p"));if(E.lineHeight)for(var w=0;w<v.length;w++)v[w].style.lineHeight=E.lineHeight;if(E.body&&1<v.length)for(var S=1;S<v.length-1;S++)E.body.marginTop&&(v[S].style.marginTop=E.body.marginTop),E.body.color&&(v[S].style.color=E.body.color);E.closing&&2<v.length&&(x=v[v.length-1],E.closing.marginTop)&&(x.style.marginTop=E.closing.marginTop),h=b.innerHTML}f.innerHTML=h}else"sales_rep"===n.sender?(x=Q(n.text).replace(/\n/g,"<br>"),b="Sales Representative",n.senderName&&("string"==typeof n.senderName?b=n.senderName:n.senderName.name&&(b=n.senderName.name)),f.innerHTML='<div style=" padding-bottom: 6px; font-size: 12px; color: #6b7280; font-weight: 500;">~ '+b+"</div>"+x,f.style.fontWeight="500",f.style.lineHeight="1.4",f.style.display="block",f.style.width="100%"):f.innerHTML=Q(n.text).replace(/\n/g,"<br>");u.appendChild(f)}m.appendChild(u),n.isWelcomeMessage||((h=document.createElement("div")).style.fontSize="12px",h.style.color=k.timestampColor||"#9ca3af",h.style.alignSelf="user"===n.sender?"flex-end":"flex-start",h.innerText=n.created_at,m.appendChild(h)),l&&r.appendChild(l),r.appendChild(m),s.appendChild(r),L.appendChild(s)}}C.quickQuestions&&0<C.quickQuestions.length&&(L.appendChild(I),t=0===e.length||1===e.length&&e[0].isWelcomeMessage,C.quickQuestionsPermanent||t?I.style.display="flex":I.style.display="none"),L.scrollTop=L.scrollHeight,setTimeout(function(){L.scrollTop=L.scrollHeight,Y()},100)}function Y(){var e=L.scrollHeight-L.scrollTop<=L.clientHeight+100;g.style.display=e?"none":"flex"}function X(){var t=0;!function e(){L.scrollTop=L.scrollHeight,++t<5&&L.scrollTop<L.scrollHeight-L.clientHeight-10?setTimeout(e,50):Y()}()}function H(e,t,o=""){var n=JSON.parse(localStorage.getItem("simple-chat-messages")||"[]");"welcomeMessage"===o?-1!==(o=n.findIndex(e=>e.isWelcomeMessage))?n[o].text=e:n.push({text:e,isWelcomeMessage:!0,sender:t}):n.push({text:e,isWelcomeMessage:!1,sender:t,created_at:B((new Date).toISOString())}),localStorage.setItem("simple-chat-messages",JSON.stringify(n))}async function M(){if(!s&&!l){var t=localStorage.getItem("simple-chat-session");if(t)try{var e=JSON.parse(t);if(!e.chatID||!e.visitorInfo)throw new Error("Invalid or expired session");r=e.chatID,m=e.visitorInfo}catch(e){console.log("Invalid session data, generating new session"),localStorage.removeItem("simple-chat-session"),t=null}t||(e={chatID:r=D(),timestamp:(new Date).toISOString()},v&&m&&(e.visitorInfo=m),localStorage.setItem("simple-chat-session",JSON.stringify(e)));t=te(),e=""+O+C.org_id+`/?visitor_info=${JSON.stringify(m)}&browser_metadata=`+encodeURIComponent(JSON.stringify(t));try{(l=new WebSocket(e)).onopen=function(){if(s=!0,l.readyState===WebSocket.OPEN){let e={message_type:"heartbeat",timestamp:Date.now()};o=setInterval(function(){l.send(JSON.stringify(e))},2500)}},l.onmessage=function(e){e=JSON.parse(e.data);if(e?.room_name&&e?.room_name===r){if("unread_message"===e?.message_type)return;if("handover_requested"===e?.message_type)return;if("handover_message"===e?.message_type){T=!0;var t=localStorage.getItem("simple-chat-session");if(t)try{var o=JSON.parse(t);o.handoverOccurred=!0,localStorage.setItem("simple-chat-session",JSON.stringify(o))}catch(e){console.log("Error updating session with handover flag:",e)}return(t=JSON.parse(localStorage.getItem("simple-chat-messages")||"[]")).push({text:e.sender?.name+" has entered the chat",sender:"system",isWelcomeMessage:!1,isSystemNotification:!0,notificationType:"joined",created_at:B(e.created_at||(new Date).toISOString())}),localStorage.setItem("simple-chat-messages",JSON.stringify(t)),void S()}if("ai"!==e.sender_type&&"ai"!==e.sender&&"bot"!==e.sender_type&&"bot"!==e.sender||T){if("sales_rep"===e.sender_type||"sales_rep"===e.sender){if(!(n=e.content||"")||!n.trim())return;(t=JSON.parse(localStorage.getItem("simple-chat-messages")||"[]")).push({text:n,sender:e.sender_type,senderName:e.sender||e.sender_name||"Sales Representative",isWelcomeMessage:!1,created_at:B(e.created_at)}),localStorage.setItem("simple-chat-messages",JSON.stringify(t)),S()}}else{var o=(t=JSON.parse(localStorage.getItem("simple-chat-messages")||"[]"))[t.length-1],n=(!o||""!==o.text||"bot"!==o.sender&&"ai"!==o.sender||(t.pop(),o=t[t.length-1]||null),e.content||e.message||"");if(!0===e.is_complete&&""===n)return void(o&&o.isStreaming&&(console.log("Stream completed"),o.isStreaming=!1,t[t.length-1]=o,localStorage.setItem("simple-chat-messages",JSON.stringify(t))));n&&(!o||"bot"!==o.sender&&"ai"!==o.sender||!0!==o.isStreaming?t.push({text:n,sender:"bot",isWelcomeMessage:!1,isStreaming:!0,messageId:e.message_id,created_at:B(e.created_at),lastChunkTime:Date.now()}):(o.text+=n,o.lastChunkTime=Date.now(),t[t.length-1]=o),localStorage.setItem("simple-chat-messages",JSON.stringify(t)),S())}}},l.onclose=function(){console.error("WebSocket connection closed unexpectedly..."),s=!1,l=null,o&&clearInterval(o),o=null},l.onerror=function(e){console.error("WebSocket error:",e),s=!1,l=null,o&&clearInterval(o),o=null}}catch(e){console.error("Failed to create WebSocket connection:",e),s=!1,l=null,o&&clearInterval(o),o=null}}}function B(e){return new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}function G(t){var o=x.value.trim()||t;if(o)if(H(o,"user"),x.value="",b.disabled=!0,b.style.opacity="0.5",b.style.cursor="not-allowed",S(),T||(H("","bot"),S()),s&&l&&l.readyState===WebSocket.OPEN)try{l.send(JSON.stringify({message:o,message_type:"text",room_name:r}))}catch(e){console.error("Error sending message:",e);t=JSON.parse(localStorage.getItem("simple-chat-messages")||"[]");0<t.length&&""===t[t.length-1].text&&t.pop(),t.push({text:"Error sending message. Please try again.",sender:"bot",isWelcomeMessage:!1}),localStorage.setItem("simple-chat-messages",JSON.stringify(t)),S()}else{M();var n=function(){var e;l&&l.readyState===WebSocket.OPEN?l.send(JSON.stringify({message:o,message_type:"text",room_name:r})):l&&l.readyState===WebSocket.CONNECTING?setTimeout(n,100):(0<(e=JSON.parse(localStorage.getItem("simple-chat-messages")||"[]")).length&&""===e[e.length-1].text&&e.pop(),e.push({text:"Error: Could not connect to chat service.",sender:"bot",isWelcomeMessage:!1}),localStorage.setItem("simple-chat-messages",JSON.stringify(e)),S())};setTimeout(n,500)}}function K(r){w=!0,A(),L.innerHTML="";var e=document.createElement("div"),t=(e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.style.height="100%",e.style.width="100%",e.style.padding="16px",e.style.boxSizing="border-box",e.style.overflow="hidden",e.style.justifyContent="center",document.createElement("div")),o=(t.style.flex="1",t.style.width="100%",t.style.display="flex",t.style.justifyContent="center",t.style.paddingBottom="16px",document.createElement("div")),n=(o.style.width="100%",o.style.maxWidth=window.innerWidth<=768?"none":"300px",o.style.display="flex",o.style.flexDirection="column",o.style.gap="20px",C.leadFormHelperText||{}),l=document.createElement("div"),n=(l.innerText=n.text||"To help us provide you with better service and personalized assistance, please share your details below.",l.style.fontSize=n.fontSize||"13px",l.style.lineHeight=n.lineHeight||"1.5",l.style.textAlign=n.textAlign||"center",l.style.padding=n.padding||"11px",l.style.marginBottom=n.marginBottom||"4px",l.style.border=n.border||"1px dashed #8348FF",l.style.background=n.background||"#f5f0ff",l.style.color=n.color||"#8348FF",l.style.fontStyle=n.fontStyle||"italic",l.style.borderRadius=n.borderRadius||"6px",l.style.flexShrink="0",document.createElement("div")),s=(n.style.display="flex",n.style.flexDirection="column",n.style.gap="4px",n.style.marginBottom="4px",n.style.height="63px",document.createElement("div")),i=(s.style.display="flex",s.style.alignItems="center",s.style.gap="12px",document.createElement("label")),a=(i.innerText="Full Name:*",i.style.minWidth="80px",i.style.fontSize="14px",i.style.fontWeight="500",i.style.color="#374151",i.style.flexShrink="0",document.createElement("input")),d=(a.type="text",a.placeholder="Full name",a.style.flex="1",a.style.padding="10px 12px",a.style.border="1px solid #d1d5db",a.style.borderRadius="6px",a.style.fontSize="14px",a.style.outline="none",a.style.transition="all 0.2s ease-in-out",a.style.fontFamily=k.messageFontFamily||k.fontFamily||"sans-serif",a.addEventListener("focus",function(){a.style.borderColor="#3b82f6",a.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"}),a.addEventListener("blur",function(){a.classList.contains("error")||(a.style.borderColor="#d1d5db"),a.style.boxShadow="none"}),a.addEventListener("input",function(){a.value.trim()&&(a.classList.remove("error"),a.style.borderColor="#d1d5db",d.style.opacity="0",d.style.maxHeight="0")}),s.appendChild(i),s.appendChild(a),document.createElement("div")),i=(d.style.color="#ef4444",d.style.fontSize="11px",d.style.marginLeft="92px",d.style.opacity="0",d.style.maxHeight="0",d.style.overflow="hidden",d.style.transition="all 0.3s ease-in-out",d.innerText="Full name is required",n.appendChild(s),n.appendChild(d),document.createElement("div")),s=(i.style.display="flex",i.style.flexDirection="column",i.style.gap="4px",i.style.marginBottom="4px",i.style.height="63px",document.createElement("div")),y=(s.style.display="flex",s.style.alignItems="center",s.style.gap="12px",document.createElement("label")),c=(y.innerText="Email:*",y.style.minWidth="80px",y.style.fontSize="14px",y.style.fontWeight="500",y.style.color="#374151",y.style.flexShrink="0",document.createElement("input")),p=(c.type="email",c.placeholder="Email",c.style.flex="1",c.style.padding="10px 12px",c.style.border="1px solid #d1d5db",c.style.borderRadius="6px",c.style.fontSize="14px",c.style.outline="none",c.style.transition="all 0.2s ease-in-out",c.style.fontFamily=k.messageFontFamily||k.fontFamily||"sans-serif",c.addEventListener("focus",function(){c.style.borderColor="#3b82f6",c.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"}),c.addEventListener("blur",function(){c.classList.contains("error")||(c.style.borderColor="#d1d5db"),c.style.boxShadow="none"}),c.addEventListener("input",function(){c.value.trim()&&(c.classList.remove("error"),c.style.borderColor="#d1d5db",p.style.opacity="0",p.style.maxHeight="0")}),s.appendChild(y),s.appendChild(c),document.createElement("div")),y=(p.style.color="#ef4444",p.style.fontSize="11px",p.style.marginLeft="92px",p.style.opacity="0",p.style.maxHeight="0",p.style.overflow="hidden",p.style.transition="all 0.3s ease-in-out",p.innerText="Please enter a valid email address",i.appendChild(s),i.appendChild(p),document.createElement("div")),s=(y.style.display="flex",y.style.flexDirection="column",y.style.gap="4px",y.style.marginBottom="4px",y.style.height="63px",document.createElement("div")),m=(s.style.display="flex",s.style.alignItems="center",s.style.gap="12px",document.createElement("label")),u=(m.innerText="Phone:*",m.style.minWidth="80px",m.style.fontSize="14px",m.style.fontWeight="500",m.style.color="#374151",m.style.flexShrink="0",document.createElement("input")),g=(u.type="tel",u.placeholder="Phone number",u.maxLength=20,u.style.flex="1",u.style.padding="10px 12px",u.style.border="1px solid #d1d5db",u.style.borderRadius="6px",u.style.fontSize="14px",u.style.outline="none",u.style.transition="all 0.2s ease-in-out",u.style.fontFamily=k.messageFontFamily||k.fontFamily||"sans-serif",u.addEventListener("focus",function(){u.style.borderColor="#3b82f6",u.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"}),u.addEventListener("blur",function(){u.classList.contains("error")||(u.style.borderColor="#d1d5db"),u.style.boxShadow="none"}),u.addEventListener("input",function(){u.value.trim()&&(u.classList.remove("error"),u.style.borderColor="#d1d5db",g.style.opacity="0",g.style.maxHeight="0")}),s.appendChild(m),s.appendChild(u),document.createElement("div")),m=(g.style.color="#ef4444",g.style.fontSize="11px",g.style.marginLeft="92px",g.style.opacity="0",g.style.maxHeight="0",g.style.overflow="hidden",g.style.transition="all 0.3s ease-in-out",g.innerText="Phone number is required",y.appendChild(s),y.appendChild(g),document.createElement("div")),s=(m.style.display="flex",m.style.flexDirection="column",m.style.gap="4px",m.style.marginBottom="4px",m.style.height="63px",document.createElement("div")),f=(s.style.display="flex",s.style.alignItems="center",s.style.gap="12px",document.createElement("label")),h=(f.innerText="Zip Code:*",f.style.minWidth="80px",f.style.fontSize="14px",f.style.fontWeight="500",f.style.color="#374151",f.style.flexShrink="0",document.createElement("input")),x=(h.type="text",h.placeholder="Zip code",h.style.flex="1",h.style.padding="10px 12px",h.style.border="1px solid #d1d5db",h.style.borderRadius="6px",h.style.fontSize="14px",h.style.outline="none",h.style.transition="all 0.2s ease-in-out",h.style.fontFamily=k.messageFontFamily||k.fontFamily||"sans-serif",h.addEventListener("focus",function(){h.style.borderColor="#3b82f6",h.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"}),h.addEventListener("blur",function(){h.classList.contains("error")||(h.style.borderColor="#d1d5db"),h.style.boxShadow="none"}),h.addEventListener("input",function(){h.value.trim()&&(h.classList.remove("error"),h.style.borderColor="#d1d5db",x.style.opacity="0",x.style.maxHeight="0")}),s.appendChild(f),s.appendChild(h),document.createElement("div")),f=(x.style.color="#ef4444",x.style.fontSize="11px",x.style.marginLeft="92px",x.style.opacity="0",x.style.maxHeight="0",x.style.overflow="hidden",x.style.transition="all 0.3s ease-in-out",x.innerText="Zip code is required",m.appendChild(s),m.appendChild(x),o.appendChild(l),o.appendChild(n),o.appendChild(i),o.appendChild(y),o.appendChild(m),t.appendChild(o),document.createElement("div")),b=(f.style.width="100%",f.style.display="flex",f.style.justifyContent="center",f.style.background="#fff",f.style.flexShrink="0",document.createElement("button"));b.innerText="Start Chat",b.style.width="100%",b.style.maxWidth=window.innerWidth<=768?"none":"300px",b.style.padding="12px 24px",b.style.background=k.sendBtnBg||"#16a34a",b.style.color="#ffffff",b.style.border="none",b.style.borderRadius="6px",b.style.cursor="pointer",b.style.fontWeight="600",b.style.fontSize="14px",b.style.transition="all 0.2s ease-in-out",b.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)",b.addEventListener("mouseover",function(){b.style.backgroundColor=k.sendBtnHover||"#15803d",b.style.transform="translateY(-1px)",b.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.15)"}),b.addEventListener("mouseout",function(){b.style.backgroundColor=k.sendBtnBg||"#16a34a",b.style.transform="translateY(0)",b.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"}),b.onclick=async function(){var e,t=a.value.trim(),o=c.value.trim(),n=u.value.trim(),l=!1,s=h.value.trim(),l=!1;a.classList.remove("error"),c.classList.remove("error"),u.classList.remove("error"),h.classList.remove("error"),a.style.borderColor="#d1d5db",c.style.borderColor="#d1d5db",u.style.borderColor="#d1d5db",h.style.borderColor="#d1d5db",d.style.opacity="0",d.style.maxHeight="0",p.style.opacity="0",p.style.maxHeight="0",g.style.opacity="0",g.style.maxHeight="0",x.style.opacity="0",x.style.maxHeight="0",t||(a.classList.add("error"),a.style.borderColor="#ef4444",d.style.opacity="1",d.style.maxHeight="40px",l=!0),o?/^\S+@\S+\.\S+$/.test(o)||(c.classList.add("error"),c.style.borderColor="#ef4444",p.innerText="Please enter a valid email address",p.style.opacity="1",p.style.maxHeight="40px",l=!0):(c.classList.add("error"),c.style.borderColor="#ef4444",p.innerText="Email is required",p.style.opacity="1",p.style.maxHeight="40px",l=!0),n?20<n.length?(u.classList.add("error"),u.style.borderColor="#ef4444",g.innerText="Phone number must be 20 characters or less",g.style.opacity="1",g.style.maxHeight="40px",l=!0):/^[\+]?[0-9\s\-\(\)\.]{1,20}$/.test(n)||(u.classList.add("error"),u.style.borderColor="#ef4444",g.innerText="Please enter a valid phone number",g.style.opacity="1",g.style.maxHeight="40px",l=!0):(u.classList.add("error"),u.style.borderColor="#ef4444",g.innerText="Phone number is required",g.style.opacity="1",g.style.maxHeight="40px",l=!0),s?/^\d+$/.test(s)?s.length<4?(h.classList.add("error"),h.style.borderColor="#ef4444",x.innerText="Zip code must be at least 4 digits",x.style.opacity="1",x.style.maxHeight="40px",l=!0):10<s.length&&(h.classList.add("error"),h.style.borderColor="#ef4444",x.innerText="Zip code must be 10 digits or less",x.style.opacity="1",x.style.maxHeight="40px",l=!0):(h.classList.add("error"),h.style.borderColor="#ef4444",x.innerText="Zip code must contain only numbers",x.style.opacity="1",x.style.maxHeight="40px",l=!0):(h.classList.add("error"),h.style.borderColor="#ef4444",x.innerText="Zip code is required",x.style.opacity="1",x.style.maxHeight="40px",l=!0),l?t?o&&/^\S+@\S+\.\S+$/.test(o)?!n||20<n.length||!/^[\+]?[0-9\s\-\(\)\.]{1,20}$/.test(n)?u.focus():(!s||!/^\d+$/.test(s)||s.length<4||10<s.length)&&h.focus():c.focus():a.focus():(L.innerHTML="",v?await oe(R(a.value),R(c.value),R(u.value),R(h.value)):await oe(null,null,null,null),l=navigator.userAgent,t=navigator.platform,o=window.location.href,n=(new Date).toISOString(),s=navigator.language,e=document.referrer,n={name:R(a.value),email:R(c.value),phone:R(u.value),zip:R(h.value),timestamp:n,userAgent:l,platform:t,url:o,language:s,referrer:e,ip:""},(l=JSON.parse(localStorage.getItem("simple-chat-leads")||"[]")).push(n),localStorage.setItem("simple-chat-leads",JSON.stringify(l)),r(n),G(`${a.value} ${c.value} ${u.value} `+h.value))},a.addEventListener("keydown",function(e){"Enter"===e.key&&b.click()}),c.addEventListener("keydown",function(e){"Enter"===e.key&&b.click()}),u.addEventListener("keydown",function(e){"Enter"===e.key&&b.click()}),h.addEventListener("keydown",function(e){"Enter"===e.key&&b.click()}),f.appendChild(b),e.appendChild(t),e.appendChild(f),L.appendChild(e),setTimeout(function(){a.focus()},100)}function F(){f.style.display="flex",f.style.flexDirection="column",f.style.width="100%",f.style.boxSizing="border-box",f.style.padding=U,f.style.gap="0",f.style.flex="0 0 auto",f.style.borderTop=V,f.style.background=k.inputContainerBg||"#ffffff",h.style.display="grid",h.style.gridTemplateColumns="1fr auto",h.style.gap="16px",h.style.alignItems="center",h.style.width="100%",x.style.padding="12px 16px",x.style.border="1px solid #d1d5db",x.style.borderRadius="6px",x.style.background=k.inputBg,x.style.color=k.inputText,x.style.fontSize="14px",x.style.lineHeight="20px",x.style.outline="none",x.style.transition="border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out",b.style.padding="12px",b.style.background=k.sendBtnBg||"#3b82f6",b.style.color="#ffffff",b.style.border="none",b.style.borderRadius="6px",b.style.cursor="pointer",b.style.display="flex",b.style.alignItems="center",b.style.justifyContent="center",b.style.transition="background-color 0.2s ease-in-out"}function R(e){return String(e).replace(/[&<>"']/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]})}b.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="'+d+'" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>',b.style.padding="12px",b.style.background=k.sendBtnBg||"#3b82f6",b.style.color="#ffffff",b.style.border="none",b.style.borderRadius="6px",b.style.cursor="pointer",b.style.display="flex",b.style.alignItems="center",b.style.justifyContent="center",b.style.transition="background-color 0.2s ease-in-out, opacity 0.2s ease-in-out",b.disabled=!0,b.style.opacity="0.5",b.style.cursor="not-allowed",b.addEventListener("mouseover",function(){b.disabled||(b.style.backgroundColor=k.sendBtnHover||"#2563eb")}),b.addEventListener("mouseout",function(){b.disabled||(b.style.backgroundColor=k.sendBtnBg||"#3b82f6")}),h.appendChild(x),h.appendChild(b),f.appendChild(h),t.appendChild(f),document.body.appendChild(t),L.addEventListener("scroll",function(){Y()}),b.onclick=G,x.addEventListener("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),G())});var _=document.createElement("button");_.setAttribute("id","chat-embed-toggle-button");function ee(){window.innerWidth,_.style.bottom="20px","left"===C.position?(_.style.left="20px",_.style.right="auto"):(_.style.right="20px",_.style.left="auto")}C.customIcon?C.customIcon.match(/^https?:\/\//)||C.customIcon.match(/\.(png|jpg|jpeg|gif|svg|webp)$/i)?_.innerHTML='<img src="'+C.customIcon+'" alt="Chat" style="width: 34px; height: 34px; object-fit: contain;" />':_.innerHTML=C.customIcon:_.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle-icon lucide-message-circle"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>',_.style.position="fixed",_.style.bottom="20px","left"===C.position?(_.style.left="20px",_.style.right="auto"):(_.style.right="20px",_.style.left="auto"),_.style.width="80px",_.style.height="80px",_.style.borderRadius="50%",_.style.backgroundColor=k.sendBtnBg||"#16a34a",_.style.color="#ffffff",_.style.border="none",_.style.cursor="pointer",_.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",_.style.display="flex",_.style.alignItems="center",_.style.justifyContent="center",_.style.transition="all 0.3s ease",_.style.zIndex=k.zIndex-1,ee(),window.addEventListener("resize",ee);var N=!(t.style.display="none");_.addEventListener("click",function(){(N=!N)?(t.style.display="flex",_.style.display="none",setTimeout(function(){X()},150)):(t.style.display="none",_.style.display="flex")}),u.onclick=function(){N=!1,t.style.display="none",_.style.display="flex"},document.body.appendChild(_),window.openChat=function(){N||(N=!0,t.style.display="flex",_.style.display="none",setTimeout(function(){X()},150))},window.closeChat=function(){N&&(N=!1,t.style.display="none",_.style.display="flex")},window.toggleChat=function(){N?window.closeChat():window.openChat()},window.saveMessage=H,window.loadMessages=S,window.generateChatId=D,window.connectWebSocket=M;let te=()=>({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,referrer:document.referrer||"direct",url:window.location.href,timestamp:(new Date).toISOString(),screenResolution:window.screen.width+"x"+window.screen.height,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,cookiesEnabled:navigator.cookieEnabled}),oe=async(t,e,o,n)=>{try{var l=C.baseUrl,s=C.token;if(!l||!s)throw console.error("baseUrl and token must be provided in SimpleChatEmbedConfig"),new Error("Missing required configuration: baseUrl and token");var r,i=!e,a=te();i&&(r=[a.userAgent,a.platform,a.language,a.screenResolution,a.timezone,a.cookiesEnabled,navigator.hardwareConcurrency||"unknown",navigator.maxTouchPoints||0,screen.colorDepth||"unknown",(new Date).getTimezoneOffset()].join("|"),e=`anonymous_${btoa(r).replace(/[^a-zA-Z0-9]/g,"").substring(0,40)}@memox.local`,t="Anonymous Visitor"),console.log(l,"before getvisitor");var d=await(await fetch(l+"visitors/?email="+e,{method:"GET",headers:{"Content-Type":"application/json",...z&&{"X-App-Platform":"react-native-webview"},Authorization:`Token ${s} `,...W&&{"ngrok-skip-browser-warning":"true"}}})).json();if(console.log(d,"my json"),"Not found."!==d.detail&&d.results?.length)m={id:d?.results[0].id,name:d?.results[0].name};else{var y={name:t,email:e,phone_number:o||"",zip_code:n||"",organization:C.org_id,metadata:{anonymous:i}},c=await fetch(l+"visitors/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Token ${s} `,...z&&{"X-App-Platform":"react-native-webview"},...W&&{"ngrok-skip-browser-warning":"true"}},body:JSON.stringify(y)});if(!c.ok)throw new Error("Failed to create visitor: "+c.status);var p=await c.json();m={id:p.id,name:p.name}}}catch(e){console.error("Error creating/fetching visitor:",e),m={id:"offline_"+Date.now(),name:t}}};if(v){i=JSON.parse(localStorage.getItem("simple-chat-messages")||"[]"),a=localStorage.getItem("simple-chat-session");if(0<i.length&&a){window.__simpleChatEmbedLeadCaptured=!0;try{var ne=JSON.parse(a);m=ne.visitorInfo,!0===ne.handoverOccurred&&(T=!0)}catch(e){console.log("Error parsing session data:",e)}F(),S(),setTimeout(function(){X()},200),M()}else window.__simpleChatEmbedLeadCaptured?(F(),S()):(f.style.display="none",K(function(e){w=!1,A(),window.__simpleChatEmbedLeadCaptured=!0,e&&(window.SimpleChatEmbedLead=e),F();JSON.parse(localStorage.getItem("simple-chat-messages")||"[]");n&&H(n,"bot","welcomeMessage"),S()}))}else window.__simpleChatEmbedLeadCaptured=!0,F(),oe(null,null,null,null).then(()=>{n&&H(n,"bot","welcomeMessage"),S(),M()}).catch(e=>{console.error("Failed to create anonymous visitor:",e),n&&H(n,"bot","welcomeMessage"),S(),M()});setTimeout(function(){var e=localStorage.getItem("simple-chat-session");if(e)try{var t=JSON.parse(e);t.chatID&&t.visitorInfo&&(m=t.visitorInfo,s||l||M())}catch(e){console.log("Error checking stored session for auto-connect:",e)}},100)}"undefined"==typeof marked?((e=document.createElement("script")).src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js",e.onload=function(){console.log("Marked.js library loaded"),t()},e.onerror=function(){console.warn("Failed to load marked.js from CDN, initializing without it"),t()},document.head.appendChild(e)):t()})();